{
  "hash": "fd6f3cfe49991901fb21bee1ceeb8ad3",
  "result": {
    "engine": "knitr",
    "markdown": "# 투자분석 과제4 {.unnumbered}\n\n## Question\n\nYou need to construct a portfolio consisting of a passive portfolio and three stocks you already selected, doing the Assignment 2. If you selected Korea (USA) stocks, use KOSPI 200 (S&P 500) for the passive portfolio.\n\nYou construct your optimal risky portfolio based on **single-index model** that was covered in class. Don’t hand in data or your program code.\n\n(a) What were the names of the individual stocks you have chosen in assignment 2? Indicate the source database.\n\n(b) With the 60 recent monthly returns of the chosen stocks, and the monthly T-bill rates for the same period, **run regressions** and report the estimated **beta**, **alpha**, **t-value** or **p-value**, **R squared** and **residual SD** of each stock and documents them.\n\n(c) Assume that the average of the risk premium of the index, forecasted by investment companies, is **6%** and its standard deviation is **15%**. Or you may use the past average excess return for the index.\n\n    If you make the optimal risky portfolio according to SIM, you **need alpha** of the expected return for each stock. **There are three options** such as \n    (i) you may randomly choose these numbers. If this is the case, be reasonable to set the value for alpha, or\n    (ii) you may use the estimated alpha in (b). for future alpha (As you know, this won’t hold generally), or \n    (iii) you may accept the 12-month future price suggested by analysts and calculate alphas using SCL.\n\n    What is your choice? **Construct and report your optimal risky portfolio** consisting of the index and the three stocks **maximizing Sharpe ratio**. Assume short-sale is allowed.\n\n(e) What is your **Information ratio** for the active portfolio you have chosen?\n\n(f) **Compare Sharpe ratio** of the optimal risky portfolio with Sharpe ratio of the index portfolio.\n\n## Answer\n\n### (a)\n\n저는 HW2에서 ***CME group(CME), ICE(ICE), Nasdaq(NDAQ)*** 세가지 종목을 선정하였습니다.\n\n선정 배경으로는,\n\n(1) 제가 거래소 산업에 관심이 많고,\n(2) 세 주식 모두 미국에 상장되어있는 대표적인 글로벌 거래소이며,\n(3) 동일한 거래소 산업이고 S&P500지수의 구성종목이라 동일 선상에서 비교하기 적합할 것으로 보이기 때문입니다.\n\n세 주식의 일별수정주가(Adj. close), 벤치마크지수인 S&P500지수의 일별수정가격을 활용하였고, 무위험이자율은 4 weeks T-bill rate를 사용하였습니다.\n\n    기간 : 직전 5년(2019.1 ~ 2023.12)\n    출처 : Yahoo Finance 및 미 재무부\n    산출방법 :\n        (월수익률) 지난달 말 대비 월말 수익률\n        (월초과수익률) 월수익률 - 월말T-bill/12\n        (월분산) 월/월초과수익률의 표본표준편차\n        (평균수익률) 월/월초과수익률을 산술평균하여 연환산 (x12)\n        (평균분산) 월분산을 산술평균하여 연환산 (x12)\n\n#### Data import and pre-processing\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nrm(list=ls())\n\nsetwd(\"/Users/hwan/Desktop/Homepage/study_24spring\")\ngetwd()\nlibrary(tidyverse)\n\n# stocks and market index S&P500 from yahoo finance\ncme <- read_csv(\"investment_hw/cme.csv\") %>% tibble()\nndaq <- read_csv(\"investment_hw/ndaq.csv\") %>% tibble()\nice <- read_csv(\"investment_hw/ice.csv\") %>% tibble()\nspx <- read_csv(\"investment_hw/spx.csv\") %>% tibble()\n# risk-free rate is T-bill rate\ntbill <- read_csv(\"investment_hw/tbill.csv\") %>% tibble()\n\n# set period 10years\nstrt_dd='20140101'\nend_dd='20231231'\n\n# tidy date\nrfr <- tbill %>% mutate(tbill=`4 WEEKS BANK DISCOUNT`) %>% \n  mutate(y=paste0(\"20\",substr(Date,nchar(Date)-1,nchar(Date)))) %>% \n  mutate(m=if_else(substr(Date,2,2)==\"/\",paste0(\"0\",substr(Date,1,1)),substr(Date,1,2))) %>% \n  mutate(d=if_else(substr(Date,2,2)==\"/\",\n                   if_else(substr(Date,4,4)==\"/\",paste0(\"0\",substr(Date,3,3)),substr(Date,3,4)),\n                   if_else(substr(Date,5,5)==\"/\",paste0(\"0\",substr(Date,4,4)),substr(Date,4,5)))) %>% \n  mutate(day=paste0(y,m,d)) %>% \n  select(day,tbill)\n\nraw_data <- tibble()\nraw_data <- cme %>% mutate(cme=`Adj Close`) %>% select(Date,cme) %>% \n  left_join(ndaq %>% mutate(ndaq=`Adj Close`) %>% select(Date,ndaq)) %>% \n  left_join(ice %>% mutate(ice=`Adj Close`) %>% select(Date,ice)) %>% \n  left_join(spx %>% mutate(spx=`Adj Close`) %>% select(Date,spx)) %>% \n  mutate(day=gsub(\"-\",\"\",Date)) %>% \n  mutate(year=substr(day,1,4)) %>% \n  mutate(month=substr(day,1,6)) %>% \n  left_join(rfr,by=\"day\") %>% \n  filter(day>=strt_dd,day<=end_dd) %>% \n  select(year,month,day,cme,ndaq,ice,spx,tbill,Date)\n\n# using monthly return\nmonthly_raw <- tibble()\nmonthly_raw <- raw_data %>% \n  group_by(year,month) %>% \n  arrange(day %>% desc()) %>% \n  slice(1) %>% \n  pivot_longer(.,c(\"cme\",\"ndaq\",\"ice\",\"spx\"),\n               names_to = \"name\",values_to = \"price\") %>% \n  ungroup() %>% \n  arrange(name,year,month) %>% \n  mutate(return=price/lag(price)-1) %>%  # monthly return\n  mutate(ex_return=return-tbill/100/12) %>% # excess return\n  filter(as.integer(month)>=201901)\n```\n:::\n\n\n### (b)\n\nSIM(Single Index Model)을 기반으로 분석하므로, 회귀식은 아래와 같습니다.\n\n$$r_{i,t}-r_{f,t}=\\alpha_i+\\beta_i(r_{M,t}-r_{i,t})+\\epsilon_{i,t}$$\n\n이에 따라 각 주식의 월초과수익률을 S&P500지수의 월초과수익률로 회귀분석을 실시하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nregression <- tibble()\nregression <- monthly_raw %>% \n  select(day,name,ex_return) %>% \n  pivot_wider(.,values_from = \"ex_return\", names_from = \"name\")\n\nreg_cme <- lm(regression$cme~regression$spx) %>% summary()\nreg_ndaq <- lm(regression$ndaq~regression$spx) %>% summary()\nreg_ice <- lm(regression$ice~regression$spx) %>% summary()\n\nresult_reg <- tibble(name=c(\"cme\",\"ndaq\",\"ice\"),\n                     alpha=c(reg_cme$coefficients[1],\n                             reg_ndaq$coefficients[1],\n                             reg_ice$coefficients[1]),\n                     beta=c(reg_cme$coefficients[2],\n                            reg_ndaq$coefficients[2],\n                            reg_ice$coefficients[2]),\n                     sd_residual=c(reg_cme$sigma,\n                                   reg_ndaq$sigma,\n                                   reg_ice$sigma))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nreg_cme\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = regression$cme ~ regression$spx)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.114664 -0.035431 -0.006045  0.029527  0.124369 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)   \n(Intercept)    0.0004469  0.0073717   0.061  0.95187   \nregression$spx 0.4493575  0.1364499   3.293  0.00169 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.05598 on 58 degrees of freedom\nMultiple R-squared:  0.1575,\tAdjusted R-squared:  0.143 \nF-statistic: 10.85 on 1 and 58 DF,  p-value: 0.001691\n```\n\n\n:::\n\n```{.r .cell-code}\nreg_ndaq\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = regression$ndaq ~ regression$spx)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.161675 -0.021231  0.003611  0.030794  0.094846 \n\nCoefficients:\n               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    0.004646   0.005915   0.785    0.435    \nregression$spx 0.947498   0.109480   8.655 4.95e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.04491 on 58 degrees of freedom\nMultiple R-squared:  0.5636,\tAdjusted R-squared:  0.5561 \nF-statistic:  74.9 on 1 and 58 DF,  p-value: 4.949e-12\n```\n\n\n:::\n\n```{.r .cell-code}\nreg_ice\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = regression$ice ~ regression$spx)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.116179 -0.027230 -0.007334  0.028422  0.137285 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    0.0002405  0.0057437   0.042    0.967    \nregression$spx 0.9886906  0.1063155   9.300 4.26e-13 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.04362 on 58 degrees of freedom\nMultiple R-squared:  0.5986,\tAdjusted R-squared:  0.5916 \nF-statistic: 86.48 on 1 and 58 DF,  p-value: 4.264e-13\n```\n\n\n:::\n:::\n\n\n결과를 표로 정리하면 아래와 같습니다.\n\n|구 분|CME|Nasdaq|ICE|\n|:---:|---:|---:|---:|\n|$\\alpha$|0.0004|0.0046|0.0002|\n|$\\beta$|0.4494|0.9475|0.9887|\n|$t-value$|3.293|8.655|9.300|\n|$p-value$|0.0017|0.0000|0.0000|\n|$Adj. R-squared$|0.143|0.5561|0.5916|\n|$residual SD$|0.0560|0.0449|0.0436|\n\n### (c)\n\n위에서 각 주식의 alpha는 모두 양수로 산출되었습니다. (ii)를 채택하여 (b)의 회귀분석 결과로 도출된 alpha를 사용하겠습니다.\n\nOptimal-risky portfolio 구축을 위해 먼저 passive 및 active p/f를 정의하겠습니다.\n\nPassive p/f는 문제에서 $E(R_M)=E(r_M-r_f)=0.06,\\;\\sigma_M=0.15$로 주어져있습니다.\n\n이는 연환산이므로 월수익률을 사용한 앞선 분석에 적용하기 위해 월단위로 환산하겠습니다.\n\n즉, **월환산 평균 리스크프리미엄은 0.005 및 표준편차는 $0.15/\\sqrt{12}=0.0433$입니다.**\n\nActive p/f는 (b)에서 도출한 alpha, beta, residual SD를 통해 구축하도록 하겠습니다.\n\n각 주식의 구성비율은 리스크대비 초과수익률($\\frac{\\alpha_i}{\\sigma^2(\\epsilon_i)}$)을 가중평균하여 산출할 수 있습니다. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive_pf <- result_reg %>% mutate(w0=alpha/sd_residual^2)\nactive_pf <- active_pf %>% mutate(w1=w0/sum(active_pf$w0))\nactive_pf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  name     alpha  beta sd_residual    w0     w1\n  <chr>    <dbl> <dbl>       <dbl> <dbl>  <dbl>\n1 cme   0.000447 0.449      0.0560 0.143 0.0554\n2 ndaq  0.00465  0.947      0.0449 2.30  0.895 \n3 ice   0.000241 0.989      0.0436 0.126 0.0492\n```\n\n\n:::\n:::\n\n\nActive p/f의 alpha, beta, residual SD는 아래와 같습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactive_pf <- active_pf %>% \n  summarise(alpha=sum(w1*alpha), beta=sum(w1*beta),\n            sd_residual=sum(w1^2*sd_residual^2) %>% sqrt())\nactive_pf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n    alpha  beta sd_residual\n    <dbl> <dbl>       <dbl>\n1 0.00420 0.922      0.0404\n```\n\n\n:::\n:::\n\n\n이제, passive & active p/f를 결합하여 Sharpe ratio가 최대값이 되는 최적 비중 $w_A^*$를 산출하도록 하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSharpe_SIM <- function(alpha_A,beta_A,SD_residual_A,weight_A=0.5,excess_M,SD_M){\n  alpha_pf=weight_A*alpha_A\n  beta_pf=weight_A*beta_A+1-weight_A\n  excess_pf=alpha_pf+beta_pf*excess_M\n  Var_residual_pf=weight_A^2*SD_residual_A^2\n  SD_pf=sqrt(beta_pf^2*SD_M^2+Var_residual_pf)\n  result <- tibble(alpha=alpha_pf,\n                   beta=beta_pf,\n                   excess_return=excess_pf,\n                   SD=SD_pf,\n                   Sharpe=excess_pf/SD_pf)\n  return(result)\n}\n\nmaximize_SIM <- function(weight_A){\n  result <- Sharpe_SIM(active_pf$alpha,active_pf$beta,active_pf$sd_residual,\n                       weight_A,0.06/12,0.15/sqrt(12))\n  return(result$Sharpe)}\n\noptimal_weight=optimize(maximize_SIM,c(0,1),maximum = TRUE)\noptimal_weight\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$maximum\n[1] 0.8969585\n\n$objective\n[1] 0.1553268\n```\n\n\n:::\n:::\n\n\n**Active p/f의 최적비중 $w_a^*=0.8969$이며, 이때 Optimal risky p/f의 Sharpe ratio는 0.1553입니다.**\n\n**Optimal risky p/f**의 alpha, beta, 초과수익률, 표준편차는 아래와 같습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSIM_optimal <- Sharpe_SIM(active_pf$alpha,active_pf$beta,active_pf$sd_residual,\n                          optimal_weight$maximum,0.06/12,0.15/sqrt(12))\nSIM_optimal                          \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 5\n    alpha  beta excess_return     SD Sharpe\n    <dbl> <dbl>         <dbl>  <dbl>  <dbl>\n1 0.00376 0.930       0.00841 0.0542  0.155\n```\n\n\n:::\n:::\n\n\n### (d)\n\nInformation ratio = $\\frac{\\alpha_A}{\\sigma(\\epsilon_A)}=0.1039$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninfo_ratio=active_pf$alpha/active_pf$sd_residual\ninfo_ratio\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1038897\n```\n\n\n:::\n:::\n\n\n### (e)\n\n각 포트폴리오의 Sharpe ratio는 아래와 같습니다.\n\n$$Sharpe\\;r/o\\;(Optimal\\;risky)\\;=\\;0.1553,\\;\\;Sharpe\\;r/o\\;(Index)\\;=\\;\\frac{0.005}{0.0433}=0.1155$$\n\nOptimal risky p/f가 보다 나은 성과를 보여주며, 정보비율로 그 차이를 표현할 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsqrt(0.1155^2+info_ratio^2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1553491\n```\n\n\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}